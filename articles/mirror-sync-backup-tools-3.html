<p><head><style>
    body        { background: #fff; margin-left:  40px;   font-size:  0.9em;  font-family: sans-serif; max-width: 800px; }
    h1          { background: #ffb; margin-left: -30px;   border-bottom: 5px  solid #ccc; }
    h2, h3      { background: #ffb; margin-left: -30px;   border-top:    3px  solid #ddd; }
    h4, h5      { background: #ffb; margin-left: -20px; }
    code        { font-size:    1.1em;  background:  #ddf; }
    pre         { margin-left:  2em;    background:  #ddf; }
    pre code    { font-size:    1.1em;  background:  #ddf; }
</style></head></p>

<h1>Beyond rsync</h1>

<p><code>rdiff-backup</code> is almost a superset of rsync in many ways.  It claims to
combine the "best features of a mirror and an incremental backup", and if you
are forced to pick <em>only one</em> tool to do your backups, this is probably the
best one.</p>

<p>The features that make rdiff-backup really stand out are:</p>

<ol>
<li>Much saner logic for file inclusions and exclusions compared to rsync,
while still using the same wonderful
<a href="mirror-sync-backup-tools-2.html#algo">difference algorithm</a> to reduce
network traffic.</li>
<li>Keeps the latest version just like rsync does (like a mirror), but <em>also
keeps older versions</em> as compressed (and reversed) rsync-style diffs
within a new directory tree called <code>rdiff-backup-data</code> on the target
disk.  What rsync does only for network bandwidth, rdiff-backup extends to
disk space also!  <strong>Very cool...</strong></li>
<li>Very easy to retrieve older versions.</li>
<li>Just as easy to purge <em>really old</em> versions that you no longer care about!</li>
</ol>

<h4>How is it used?</h4>

<ul>
<li><p>An excellent and easy to follow introduction to this powerful tool is the
"examples" page at
http://www.nongnu.org/rdiff-backup/examples.html<br/><br/></p></li>
<li><p>This is a tool that is just <strong>begging</strong> to be run from cron, so one way to
take a backup is:</p>

<ol>
<li><p>create a list of files, say <code>/root/rd-b.lst</code>.  Some illustrative parts
of my list are given below:</p>

<pre><code>/var/spool/cron
- /usr/local/share/vim
/usr/local
- /home/sitaram/.mozilla/firefox/44kffhfm.default/Cache
/home/sitaram/.mozilla
/home/sitaram/.jpilot
/home/sitaram/.freemind
/home/sitaram/.darrc
/home/sitaram/bin
/home/sitaram/.bashrc
/etc
- **
</code></pre>

<p>IMPORTANT: Paths in the include/exclude list should start with either
<code>**/</code> or the source directory name.  Using <code>./</code> won't work unless the
source directory was given as "<code>.</code>".</p>

<p>Each candidate file/dir in the source tree is tested against the list
above.  Checking stops as soon as a match is found.  If the matched
pattern is prefixed with a "<code>-</code>" sign, the file/dir and all its
subdirectories/files are excluded.  Otherwise, they are included.</p>

<p>This is why exclusions at a deeper level are listed <strong>before</strong> any
parent that must be included.  Notice, for example, how the <code>cache</code>
directory is excluded first, and then the <code>mozilla</code> directory is
included.  This is because I want to back up the whole of the
<code>mozilla</code> directory except the <code>cache</code>.</p>

<p>If a file does not match <strong>any</strong> pattern, the default is to include it.
Since we don't (normally) want that, the last line lists "<code>**</code>" as
an exclusion pattern.  "<code>**</code>" is a special pattern that matches any
character, including a "<code>/</code>", so think of it as an ultra-wildcard.<br/><br/></p></li>
<li><p>run this command or put it in cron:</p>

<pre><code>rdiff-backup --include-globbing-filelist /root/rd-b.lst / /bigfs/rd-b.data
</code></pre>

<p>If you want, you can use a <code>user@host::path</code> syntax (note the
<em>double</em> colon) to put it on another machine.<br/><br/></p></li>
</ol></li>
<li><p>Restoring it is just as simple.  You can use plain <code>cp</code> or <code>scp</code> to
get the latest version (remember this is a <em>mirror</em>).  Or you can do
this:</p>

<pre><code>rdiff-backup -r now user@host::/bigfs/rd-b.data/home/sitaram/bin bin
</code></pre>

<p>will restore the bin directory.  As you can see, you can restore a
sub-tree of the full backup set if you need to.<br/><br/></p></li>
<li><p>You can get older versions too.  Replace the <code>now</code> in the above command
with something like <code>3M</code> which means "3 months", or <code>5D</code> for 5 days,
or <code>6W</code> for 6 weeks, or combinations of these, or specify an exact date
in several possible ways.  Clearly plain <code>cp</code> will not get you older
versions. Read the manual for details.<br/><br/></p></li>
<li><p>Finally, the one feature that makes it all worthwhile is the
<code>--remove-older-than</code> option.  I have an extra command in my cron job
that cleans out versions older than 3 weeks:</p>

<pre><code>rdiff-backup --remove-older-than 3W /bigfs/rd-b.data
</code></pre>

<p>This makes the whole thing pretty much zero-maintenance as long as you are
directing the backups to some other machine with enough disk space.</p></li>
</ul>

<h4>When is it useful?</h4>

<p>When you have enough space on another machine you trust, or, failing that, on
a second hard disk on your own machine, this is the best way to backup your
stuff.  Pretty much fire-and-forget!!</p>

<p><strong>If you have enough free disk, even backing up to the same hard disk may be
worthwhile, because you're at least protected from human error or software
bugs causing lost data.</strong></p>

<p>It is so efficient in both time and space that you can probably take a backup
as often as you like.  Let cron do it once a day, but by all means take
another one manually at the end of a long hard day's work!</p>

<p>You still need to do the following:</p>

<ul>
<li><p>check the <code>/root/rd-b.lst</code> file periodically to ensure that everything
you want really <strong>is</strong> being backed up.  This is not necessary if you have
asked rdiff-backup to backup the entire machine, of course!<br/><br/></p></li>
<li><p>if the "remote" machine you're backing up to is not that "remote",
(example, same building, so a fire or a flood could wipe out both!), maybe
you should find some other means to do an offsite backup :-)  <code>dar</code>
(next article!) with a DVD writer is a good solution for most people.</p></li>
</ul>

<h4>What are the downsides?</h4>

<p>Nothing major really, but you need to remember that this is a <em>mirror</em>, not a
backup in the normal sense.  For instance, you can't encrypt a mirror, so you
should only use machines you trust as the targets.</p>

<p><code>dar</code>, the subject of the next article, allows encryption, offsite/offline
backups, and other features besides, but then of course it's not a mirror, and
it can't use the rsync algorithm so it's not as efficient!  You can't have
everything in one software, as I said in the first article!</p>

<h1>What next?</h1>

<p>Well, the next chapter: <a href="mirror-sync-backup-tools-4.html">A true backup
solution -- <code>dar</code></a></p>
